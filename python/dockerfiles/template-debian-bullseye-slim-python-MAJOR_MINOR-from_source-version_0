# NOTE!
# The COPY command will only work properly if
# the command using this Dockerfile to build the Docker image
# is called from the
# save-thread-result/python directory
# and will NOT work if called from the
# save-thread-result/python/tests directory
# or the
# save-thread-result directory


FROM debian:bullseye-20231120-slim AS base

RUN \
  apt-get -y update; \
  apt-get install \
  gdb \
  # placeholder line to align with template-debian-bullseye-slim-python-MAJOR_MINOR-from_source-version_legacy_1
  curl \
  gcc \
  make \
  lcov \
  pkg-config \
  libbz2-dev \
  libffi-dev \
  libgdbm-dev \
  libgdbm-compat-dev \
  liblzma-dev \
  libncurses5-dev \
  libreadline6-dev \
  libsqlite3-dev \
  libssl-dev \
  lzma \
  lzma-dev \
  tk-dev \
  uuid-dev \
  zlib1g-dev \
  -y \
  && curl -SL https://www.python.org/ftp/python/{MAJOR_MINOR_PATCH}/Python-{MAJOR_MINOR_PATCH}.tgz | tar -xzvf - \
  && cd Python-{MAJOR_MINOR_PATCH} \
  && nproc="$(nproc)" \
  && ./configure \
  && make -j "$nproc" \
  && make altinstall

COPY . ./save_thread_result/python

CMD ["python{MAJOR_MINOR}", "save_thread_result/python/dummy_example.py"]
